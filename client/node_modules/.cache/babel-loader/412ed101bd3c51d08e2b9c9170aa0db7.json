{"ast":null,"code":"import _objectSpread from\"C:/Users/Administrator/Desktop/Whatshub_v1.2/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/Administrator/Desktop/Whatshub_v1.2/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Administrator/Desktop/Whatshub_v1.2/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/Whatshub_v1.2/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{Box,Button,Stack,Divider,Accordion,AccordionSummary,Typography,AccordionDetails,Grid,Slider,Dialog,CircularProgress}from'@mui/material';import{SendBulkContext}from'../../../../../context/SendBulkContext';import{ExpandMore}from'@mui/icons-material';import DelayMsg from'../DelayMsg';import axios from'axios';import{LoadingButton}from'@mui/lab';import qrcode from'qrcode';import{useHistory}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SendExceleMsg=function SendExceleMsg(){var sendBulk=React.useContext(SendBulkContext);var token=localStorage.getItem(process.env.REACT_APP_TOKEN+\"_user\");var _React$useState=React.useState({}),_React$useState2=_slicedToArray(_React$useState,2),state=_React$useState2[0],setState=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),qr=_React$useState4[0],setQR=_React$useState4[1];var history=useHistory();var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),qrLoad=_React$useState6[0],setQrLoad=_React$useState6[1];function qrtoBase64(qr){// console.log({ rec_in_qr: qr })\nqrcode.toDataURL(qr,function(err,src){var base64Data=src.replace(/^data:image\\/png;base64,/,\"\");setQR(base64Data);});}function getQRFromDb(unique_id){var timer=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:axios.post(\"\".concat(process.env.REACT_APP_BASE_URL,\"/api/campaign/get_one\"),{unique_id:unique_id},{headers:{Authorization:\"Bearer \"+token}}).then(function(res){qrtoBase64(res.data.data.qr_code);if(res.data.data.login_status){alert(\"Login Success\");history.push(\"/user?page=2\");clearInterval(timer);}}).catch(function(err){return console.log(err);});case 1:case\"end\":return _context.stop();}}},_callee);})),3000);}function sendExcel(){return _sendExcel.apply(this,arguments);}function _sendExcel(){_sendExcel=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setState(_objectSpread(_objectSpread({},state),{},{loading:true}));axios.post(\"\".concat(process.env.REACT_APP_BASE_URL,\"/api/campaign/send_whstapp\"),sendBulk.data,{headers:{Authorization:\"Bearer \"+token}}).then(function(res){if(!res.data.success){alert(res.data.msg);setState(_objectSpread(_objectSpread({},state),{},{loading:false}));return;}setState(_objectSpread(_objectSpread({},state),{},{loading:false,dialog:true}));getQRFromDb(res.data.unique_id);}).catch(function(err){alert(\"Something went wrong try again!\");setState(_objectSpread(_objectSpread({},state),{},{loading:false}));console.log(err);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return _sendExcel.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Dialog,{open:state.dialog,onClose:function onClose(){return setState(_objectSpread(_objectSpread({},state),{},{dialog:false}));},children:/*#__PURE__*/_jsxs(Box,{p:2,children:[state.loading||qrLoad?/*#__PURE__*/_jsx(CircularProgress,{}):qr&&/*#__PURE__*/_jsx(\"img\",{src:\"data:image/png;base64,\".concat(qr)}),/*#__PURE__*/_jsx(Box,{mt:2,children:/*#__PURE__*/_jsx(Typography,{align:\"center\",children:\"Scan this QR from your WhstaApp\"})})]})}),/*#__PURE__*/_jsx(Box,{mb:2,children:/*#__PURE__*/_jsxs(Accordion,{children:[/*#__PURE__*/_jsx(AccordionSummary,{expandIcon:/*#__PURE__*/_jsx(ExpandMore,{}),children:/*#__PURE__*/_jsxs(Typography,{children:[sendBulk.data.excel_array.length,\" message(s) to be sent.\"]})}),/*#__PURE__*/_jsx(AccordionDetails,{children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:sendBulk.data.excel_array.map(function(i,key){return/*#__PURE__*/_jsx(Grid,{xs:12,sm:6,lg:3,item:true,children:/*#__PURE__*/_jsx(Box,{borderRadius:2,bgcolor:\"black\",p:2,children:/*#__PURE__*/_jsxs(Stack,{direction:'column',children:[/*#__PURE__*/_jsxs(Typography,{color:\"gray\",variant:\"caption\",children:[\"Number: \",i.numbers]}),/*#__PURE__*/_jsxs(Typography,{color:\"gray\",variant:\"caption\",children:[\"Message: \",sendBulk.data.sending_msg.length>21?sendBulk.data.sending_msg.slice(0,20).replace(\"{var_one}\",i.var_one).replace(\"{var_two}\",i.var_two)+\"...\":sendBulk.data.sending_msg.replace(\"{var_one}\",i.var_one).replace(\"{var_two}\",i.var_two)]}),sendBulk.data.with_media&&/*#__PURE__*/_jsx(Typography,{color:\"gray\",variant:\"caption\",children:\"Media: Attached\"})]})})},key);})})})]})}),/*#__PURE__*/_jsx(DelayMsg,{}),/*#__PURE__*/_jsx(Box,{mb:2,mt:2,children:/*#__PURE__*/_jsx(Divider,{})}),/*#__PURE__*/_jsxs(Stack,{direction:'column',spacing:2,children:[/*#__PURE__*/_jsx(LoadingButton,{size:\"small\",variant:\"contained\",onClick:sendExcel,loading:state.loading,children:\"Scan QR and send\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return sendBulk.setData(_objectSpread(_objectSpread({},sendBulk.data),{},{step:2}));},variant:\"outlined\",size:\"small\",children:\"Back\"})]})]});};export default SendExceleMsg;","map":{"version":3,"names":["React","Box","Button","Stack","Divider","Accordion","AccordionSummary","Typography","AccordionDetails","Grid","Slider","Dialog","CircularProgress","SendBulkContext","ExpandMore","DelayMsg","axios","LoadingButton","qrcode","useHistory","SendExceleMsg","sendBulk","useContext","token","localStorage","getItem","process","env","REACT_APP_TOKEN","useState","state","setState","qr","setQR","history","qrLoad","setQrLoad","qrtoBase64","toDataURL","err","src","base64Data","replace","getQRFromDb","unique_id","timer","setInterval","post","REACT_APP_BASE_URL","headers","Authorization","then","res","data","qr_code","login_status","alert","push","clearInterval","catch","console","log","sendExcel","loading","success","msg","dialog","excel_array","length","map","i","key","numbers","sending_msg","slice","var_one","var_two","with_media","setData","step"],"sources":["C:/Users/Administrator/Desktop/Whatshub_v1.2/client/src/user/pages/bulk-msg/components/excel/SendExcelMsg.js"],"sourcesContent":["import React from 'react'\r\nimport { Box, Button, Stack, Divider, Accordion, AccordionSummary, Typography, AccordionDetails, Grid, Slider, Dialog, CircularProgress } from '@mui/material'\r\nimport { SendBulkContext } from '../../../../../context/SendBulkContext'\r\nimport { ExpandMore } from '@mui/icons-material'\r\nimport DelayMsg from '../DelayMsg'\r\nimport axios from 'axios'\r\nimport { LoadingButton } from '@mui/lab'\r\nimport qrcode from 'qrcode'\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nconst SendExceleMsg = () => {\r\n    const sendBulk = React.useContext(SendBulkContext)\r\n    const token = localStorage.getItem(process.env.REACT_APP_TOKEN + \"_user\")\r\n    const [state, setState] = React.useState({})\r\n    const [qr, setQR] = React.useState(\"\")\r\n    const history = useHistory()\r\n    const [qrLoad, setQrLoad] = React.useState(false)\r\n\r\n\r\n    function qrtoBase64(qr) {\r\n        // console.log({ rec_in_qr: qr })\r\n        qrcode.toDataURL(qr, (err, src) => {\r\n            var base64Data = src.replace(/^data:image\\/png;base64,/, \"\")\r\n            setQR(base64Data)\r\n        });\r\n    }\r\n\r\n    function getQRFromDb(unique_id) {\r\n        const timer = setInterval(async () => {\r\n            axios.post(`${process.env.REACT_APP_BASE_URL}/api/campaign/get_one`, {\r\n                unique_id: unique_id\r\n            }, {\r\n                headers: {\r\n                    Authorization: \"Bearer \" + token\r\n                }\r\n            }).then((res) => {\r\n                qrtoBase64(res.data.data.qr_code)\r\n                if (res.data.data.login_status) {\r\n                    alert(\"Login Success\")\r\n                    history.push(\"/user?page=2\")\r\n                    clearInterval(timer)\r\n                }\r\n            }).catch(((err) => console.log(err)))\r\n        }, 3000)\r\n    }\r\n\r\n\r\n    async function sendExcel() {\r\n        setState({ ...state, loading: true })\r\n        axios.post(`${process.env.REACT_APP_BASE_URL}/api/campaign/send_whstapp`, sendBulk.data, {\r\n            headers: {\r\n                Authorization: \"Bearer \" + token\r\n            }\r\n        }).then((res) => {\r\n            if (!res.data.success) {\r\n                alert(res.data.msg)\r\n                setState({ ...state, loading: false })\r\n                return\r\n            }\r\n            setState({ ...state, loading: false, dialog: true })\r\n            getQRFromDb(res.data.unique_id)\r\n        }).catch((err) => {\r\n            alert(\"Something went wrong try again!\")\r\n            setState({ ...state, loading: false })\r\n            console.log(err)\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Dialog open={state.dialog} onClose={() => setState({ ...state, dialog: false })}>\r\n                <Box p={2}>\r\n                    {\r\n                        state.loading || qrLoad ? (\r\n                            <CircularProgress />\r\n                        ) : (\r\n                            qr && <img src={`data:image/png;base64,${qr}`} />\r\n                        )\r\n                    }\r\n                    <Box mt={2}>\r\n                        <Typography align='center' >Scan this QR from your WhstaApp</Typography>\r\n                    </Box>\r\n                </Box>\r\n            </Dialog>\r\n\r\n            <Box mb={2}>\r\n                <Accordion>\r\n                    <AccordionSummary\r\n                        expandIcon={<ExpandMore />}>\r\n                        <Typography>{sendBulk.data.excel_array.length} message(s) to be sent.</Typography>\r\n                    </AccordionSummary>\r\n                    <AccordionDetails>\r\n                        <Grid container spacing={2} >\r\n                            {\r\n                                sendBulk.data.excel_array.map((i, key) => {\r\n                                    return (\r\n                                        <Grid key={key} xs={12} sm={6} lg={3} item>\r\n                                            <Box borderRadius={2} bgcolor='black' p={2}>\r\n                                                <Stack direction={'column'}>\r\n                                                    <Typography color='gray' variant='caption' >Number: {i.numbers}</Typography>\r\n                                                    <Typography color='gray' variant='caption' >Message: {sendBulk.data.sending_msg.length > 21 ? sendBulk.data.sending_msg.slice(0, 20).replace(\"{var_one}\", i.var_one).replace(\"{var_two}\", i.var_two) + \"...\" : sendBulk.data.sending_msg.replace(\"{var_one}\", i.var_one).replace(\"{var_two}\", i.var_two)}</Typography>\r\n                                                    {sendBulk.data.with_media && <Typography color='gray' variant='caption' >Media: Attached</Typography>}\r\n                                                </Stack>\r\n                                            </Box>\r\n                                        </Grid>\r\n                                    )\r\n                                })\r\n                            }\r\n                        </Grid>\r\n                    </AccordionDetails>\r\n                </Accordion>\r\n            </Box>\r\n\r\n            <DelayMsg />\r\n\r\n\r\n\r\n            <Box mb={2} mt={2} >\r\n                <Divider />\r\n            </Box>\r\n\r\n            <Stack direction={'column'} spacing={2}>\r\n\r\n                <LoadingButton\r\n                    size='small'\r\n                    variant='contained'\r\n                    onClick={sendExcel}\r\n                    loading={state.loading}\r\n                >\r\n                    Scan QR and send\r\n                </LoadingButton>\r\n\r\n                <Button\r\n                    onClick={() => sendBulk.setData({ ...sendBulk.data, step: 2 })}\r\n                    variant='outlined'\r\n                    size='small'>Back</Button>\r\n\r\n            </Stack>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default SendExceleMsg"],"mappings":"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"},"metadata":{},"sourceType":"module"}